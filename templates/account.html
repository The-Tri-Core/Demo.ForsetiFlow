<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Forseti Flow Account</title>
    <link rel="stylesheet" href="/static/main.css" />
  </head>
  <body>
    <div class="gradient-bg"></div>
    <a class="brand-logo" href="/">
      <img src="/static/ForsetiLogo.png" alt="Forseti Flow logo" />
    </a>
    <main class="login-page">
      <article class="login-card">
        <div>
          <p class="eyebrow">Forseti Flow</p>
          <h1>Secure your account</h1>
          <p class="lede">
            {% if requires_update %}
            As part of the onboarding step, choose a new username or password before continuing.
            {% else %}
            Update your username, email, or password whenever you need to rotate credentials.
            {% endif %}
          </p>
        </div>
        {% if error %}
        <p class="login-status error">{{ error }}</p>
        {% endif %}
        <form method="post" class="login-form" autocomplete="off">
          <label>
            <span>Username</span>
            <input
              type="text"
              name="username"
              value="{{ user.username }}"
              required
              autocomplete="username"
            />
          </label>
          <label>
            <span>Email (optional)</span>
            <input
              type="email"
              name="email"
              value="{{ user.email or '' }}"
              autocomplete="email"
            />
          </label>
          <label>
            <span>New password</span>
            <input
              type="password"
              name="password"
              placeholder="Leave blank to keep current"
              autocomplete="new-password"
            />
          </label>
          <label>
            <span>Confirm new password</span>
            <input type="password" name="confirm_password" autocomplete="new-password" />
          </label>
          {% if mfa_setup_required %}
          <div class="mfa-setup">
            <p class="muted login-hint">
              Scan the QR code below with Google or Microsoft Authenticator, then enter the six-digit code.
            </p>
            {% if mfa_qr %}
            <img src="{{ mfa_qr }}" alt="Authenticator setup QR code" class="mfa-qr" />
            {% endif %}
            <p class="muted login-hint">
              Secret: <code>{{ mfa_secret or "provided by the app" }}</code>
            </p>
            <label>
              <span>Authenticator code</span>
              <input
                type="text"
                name="totp_code"
                inputmode="numeric"
                pattern="[0-9]*"
                placeholder="123456"
                required
                autocomplete="one-time-code"
              />
            </label>
          </div>
          {% endif %}
          <button type="submit" class="pill primary">
            {% if requires_update %}Save & Continue{% else %}Save changes{% endif %}
          </button>
        </form>
        <a class="pill ghost login-guest" href="/logout">Log out</a>
      </article>
    </main>
    {% if demo_mode %}<div class="demo-watermark">DEMO</div>{% endif %}
  </body>
</html>
